!==============================================================================!
  subroutine Residual(n, nb, A, x, r1) 
!------------------------------------------------------------------------------!
!   Calculates residuals.                                                      !
!------------------------------------------------------------------------------!
!----------------------------------[Modules]-----------------------------------!
  use Comm_Mod
  use Matrix_Mod
!------------------------------------------------------------------------------!
  implicit none
!---------------------------------[Arguments]----------------------------------!
  integer           :: n, nb
  type(Matrix_Type) :: A
  real              :: x(-nb:n), r1(n)  !  [A]{x}={r1}
!-----------------------------------[Locals]-----------------------------------!
  integer  :: i,j,k,sub
!==============================================================================!

  !----------------!
  !   r = b - Ax   !
  !----------------!
  do i=1,n
    do j=A % row(i),A % row(i+1)-1     
      k = A % col(j)                 
      r1(i) = r1(i) - A % val(j) * x(k)  
    end do
  end do

! call exchange(x) 

  do sub=1,n_proc
    if(nbb_e(sub)  <=  nbb_s(sub)) then
      do k=nbb_s(sub),nbb_e(sub),-1
        i=BufInd(k)
        r1(i) = r1(i) - A % bou(k)*x(k)
      end do
    end if
  end do

  end subroutine
